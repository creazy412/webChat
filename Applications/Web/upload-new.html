<a href="javascript:;" class="choose-img button">选择图片</a>
<span>（可以使用截图工具截图后在此Ctrl+V）</span>
<input type="file" multiple="multiple" name="picture" accept="image/*" style="width: 0;height: 0;float: left;">
<div class="image-lists"></div>
<a href="javascript:;" class="upload-img button float-right">发送</a>
<script>
    function prevview(error, src) {
        if(error)
            console.log('not image!');
        else
            $('<div/>').addClass('image-msg').append($('<a/>').addClass('remove-img button-close').attr('href','javascript:;').css({'top':'7px','right':'11px'}).html('&times;')).append('<img src="'+src+'">').appendTo($('.image-lists'));
    }
    function addfile(file) {
        /*'<div class="image-msg"> \
            <p class="image-name">'+file.name+'</p> \
            <p class="image-wrap"></p> \
            <p class="image-progress"><span></span></p> \
            <a href="javascript:;" class="remove-img button-close" style="top:7px;right:11px;">&times;</a> \
        </div>'.appendTo($('.image-lists'));*/
        uploader.thumb(file, prevview,{
            width  : 98,
            height : 94,
            type   : 'image/jpeg'
        });
    }
    $(function(){
        $('.choose-img').click(function(){
            $('input[name=picture]').click();
        })
		$('input[name=picture]').change(function(e){
            var x = 0;
            while(x < e.target.files.length) {
                if($('.image-lists').children().length+x >= 8)
                    break;
                addfile(e.target.files[x]);
                x++;
            }
        })
        uploader.drop(document, prevview, {
            width  : 98,
            height : 94,
            type   : 'image/jpeg'
        });
        uploader.paste(document, prevview, {
            width  : 98,
            height : 94,
            type   : 'image/jpeg'
        });
		$('.upload-img').click(function(){
            console.log('wait')
			/*if($(this).prev('.image-lists').children().length == 0)
				return false;
            $(this).addClass('disabled');
            //截图以base64的形式上传，否则以文件流切割上传
            //截图没有name属性
            for(var x in imageLists) {
                if(imageLists[x].file.name == null) {
                    var formData = new FormData();
                    formData.append('image',imageLists[x].src);
                    upload(formData);
                }else{
                    chunk(imageLists[x].file, imageLists[x].compress);
                }
            }
            $('.modal-close').click()*/
		})
		$('.image-lists').on('click','.remove-img',function(){
			$(this).parent().remove();
		})
	})
</script>
